<!DOCTYPE html>
<html  lang="zh">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
<title>Young&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



    <meta name="description" content="每个人都是平凡的，同时也是与众不同的。">
<meta property="og:type" content="website">
<meta property="og:title" content="Young&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Young&#39;s Blog">
<meta property="og:description" content="每个人都是平凡的，同时也是与众不同的。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Young&#39;s Blog">
<meta name="twitter:description" content="每个人都是平凡的，同时也是与众不同的。">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
<body class="is-3-column">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Young&#39;s Blog" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-31T16:00:00.000Z">2018-04-01</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 分钟 读完 (大约 2526 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/01/爬虫-淘宝/">爬取淘宝商品列表</a>
            
        </h1>
        <div class="content">
            <p>前段时间老师让我爬取淘宝的商品列表以及其商品详情数据，期间遇到了很多问题。最困难的就是淘宝的价格数据是以Ajax异步加载的，这些数据暂时还没有能力获取到。</p>
<p>下面介绍一下基本思路。</p>
<p>首先，通过抓取商品列表的商品ID获取商品的身份标识，然后根据商品ID跳转到具体的商品列表，对其他属性进行抓取。</p>
<p>观察两条商品列表的URL：</p>
<pre><code>https://s.taobao.com/search?q=帽子&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.50862.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170806&amp;bcoffset=7&amp;ntoffset=7&amp;p4ppushleft=1%2C48&amp;s=0

https://s.taobao.com/search?q=帽子&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.50862.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170806&amp;bcoffset=4&amp;ntoffset=4&amp;p4ppushleft=1%2C48&amp;s=44

https://s.taobao.com/search?q=帽子&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.50862.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170806&amp;bcoffset=4&amp;ntoffset=4&amp;p4ppushleft=1%2C48&amp;s=88</code></pre><p>这是前三个页面的URL，可以发现，除了”q=”和”s=”后面的数据不一样，其他的都是一样的，因此，可以把URL简化为：</p>
<p><a href="https://s.taobao.com/search?q=keyword&amp;s=pagenum" target="_blank" rel="noopener">https://s.taobao.com/search?q=keyword&amp;s=pagenum</a></p>
<p>其中，q代表搜索的关键词，s代表商品列表的页数，0代表第一页，44代表第二页，88代表第三页……</p>
<p>先以此URL抓取商品的ID等信息。</p>
<p>代码如下。</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> *</span><br><span class="line"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getDetails</span><span class="hljs-params">(startpage,endpage)</span>:</span></span><br><span class="line">	<span class="hljs-comment">#如果需要爬取具体的商品详情，页数过多可能会出现异常，此函数可以用来控制一次爬取的页数</span></span><br><span class="line">	url_head=<span class="hljs-string">'https://s.taobao.com/search?q=帽子&amp;s='</span>   </span><br><span class="line">	<span class="hljs-comment">#这是淘宝搜索列表的url前面的相同部分，q=''代表搜索的关键词，s=''代表第几页，s=0为第1页s=44为第二页，以此类推</span></span><br><span class="line"></span><br><span class="line">	url_list=[url_head+str(i*<span class="hljs-number">44</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(startpage<span class="hljs-number">-1</span>,endpage)]  <span class="hljs-comment">#生成需要爬取的商品列表url</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">#定义存储商品列表数据数据的列表</span></span><br><span class="line">	nid_list=[]</span><br><span class="line">	raw_title_list=[]</span><br><span class="line">	view_price_list=[]</span><br><span class="line">	view_sales_list=[]</span><br><span class="line">	item_loc_list=[]</span><br><span class="line">	<span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> url_list:</span><br><span class="line">	    resp=requests.get(url)</span><br><span class="line">	    print(resp.url)</span><br><span class="line">	    nid=re.findall(pattern=<span class="hljs-string">'"nid":"(.*?)"'</span>,string=resp.text)  <span class="hljs-comment">#商品id,唯一，可以此跳转到其商品详情页面，然后进行其他信息的抓取</span></span><br><span class="line">	    raw_title=re.findall(pattern=<span class="hljs-string">'"raw_title":"(.*?)"'</span>,string=resp.text)  <span class="hljs-comment">#商品名称</span></span><br><span class="line">	    view_price=re.findall(pattern=<span class="hljs-string">'"view_price":"(.*?)"'</span>,string=resp.text)  <span class="hljs-comment">#商品价格</span></span><br><span class="line">	    view_sales=re.findall(pattern=<span class="hljs-string">'"view_sales":"(.*?)"'</span>,string=resp.text)  <span class="hljs-comment">#商品销量</span></span><br><span class="line">	    item_loc=re.findall(pattern=<span class="hljs-string">'"item_loc":"(.*?)"'</span>,string=resp.text)  <span class="hljs-comment">#发货地址</span></span><br><span class="line"></span><br><span class="line">	    <span class="hljs-comment">#逐个存储</span></span><br><span class="line">	    nid_list.extend(nid)</span><br><span class="line">	    raw_title_list.extend(raw_title)</span><br><span class="line">	    view_price_list.extend(view_price)</span><br><span class="line">	    view_sales_list.extend(view_sales)</span><br><span class="line">	    item_loc_list.extend(item_loc)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">#生成数据框</span></span><br><span class="line">	dt=&#123;<span class="hljs-string">'商品id'</span>:nid_list,<span class="hljs-string">'商品名称'</span>:raw_title_list,<span class="hljs-string">'商品价格'</span>:view_price_list,</span><br><span class="line">					<span class="hljs-string">'商品销量'</span>:view_sales_list,<span class="hljs-string">'商品发货地址'</span>:item_loc_list&#125;</span><br><span class="line"></span><br><span class="line">	df=DataFrame(dt)  <span class="hljs-comment">#根据字典生成数据框</span></span><br><span class="line">	<span class="hljs-comment">#写入Excel</span></span><br><span class="line">	writer1=ExcelWriter(<span class="hljs-string">"taobao_details.xlsx"</span>)  <span class="hljs-comment">#新建一个空白Excel工作簿</span></span><br><span class="line">	df.to_excel(writer1,<span class="hljs-string">"Sheet1"</span>)  <span class="hljs-comment">#将df写入Sheet1工作表</span></span><br><span class="line">	writer1.save()</span><br></pre></td></tr></table></figure>

<p>上述代码可以获取到商品ID、商品名称、商品价格、商品销量、发货地址信息。接下来，利用商品ID信息，跳转到具体的商品详情页面，对其他属性进行抓取。</p>
<p>对其他属性的抓取，主要着眼于两个方面。一个是商品的描述、服务于物流评分，这个虽然淘宝与天猫的HTML页面有所差别，但是获取方式大同小异。另外，所有的商品详情都放在了一个列表里面，因此用beautifulsoup提取十分方便。</p>
<p>抓取淘宝商品详情的代码如下：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getTaoBaoDetails</span><span class="hljs-params">(url)</span>:</span></span><br><span class="line">	<span class="hljs-keyword">import</span> requests</span><br><span class="line">	<span class="hljs-keyword">import</span> re</span><br><span class="line">	<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup</span><br><span class="line">	<span class="hljs-comment"># from pandas import DataFrame</span></span><br><span class="line">	<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict</span><br><span class="line">	res=requests.get(url)</span><br><span class="line">	soup=BeautifulSoup(res.text,<span class="hljs-string">"html.parser"</span>)</span><br><span class="line">	</span><br><span class="line">	dd=soup.select(<span class="hljs-string">".tb-shop-rate dd"</span>) <span class="hljs-comment">#获取描述、服务、物流的数字信息，该信息存放在一个列表，需要使用正则表达式提取</span></span><br><span class="line">	dd_value=[]</span><br><span class="line">	<span class="hljs-keyword">if</span> len(dd)&gt;<span class="hljs-number">0</span>:</span><br><span class="line">		<span class="hljs-keyword">try</span>:</span><br><span class="line">			<span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>):</span><br><span class="line">				dd_value.append(re.search(pattern=<span class="hljs-string">r'[\s]*([0-9]\.[0-9])[\s]*'</span>,string=dd[d].text).group(<span class="hljs-number">1</span>))</span><br><span class="line">		<span class="hljs-keyword">except</span> IndexError <span class="hljs-keyword">as</span> err:</span><br><span class="line">			print(res.url)</span><br><span class="line">	<span class="hljs-comment">#下面的语句获取属性列表</span></span><br><span class="line">	attrs=soup.select(<span class="hljs-string">".attributes-list li"</span>)</span><br><span class="line">	attrs_name=[]</span><br><span class="line">	attrs_value=[]</span><br><span class="line">	<span class="hljs-keyword">for</span> attr <span class="hljs-keyword">in</span> attrs:</span><br><span class="line">		attrs_name.append(re.search(<span class="hljs-string">r'(.*?):[\s]*(.*)'</span>,attr.text).group(<span class="hljs-number">1</span>))</span><br><span class="line">		attrs_value.append(re.search(<span class="hljs-string">r'(.*?):[\s]*(.*)'</span>,attr.text).group(<span class="hljs-number">2</span>))</span><br><span class="line"></span><br><span class="line">	allattrs=OrderedDict() <span class="hljs-comment">#存放该产品详情页面所具有的属性</span></span><br><span class="line">	<span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(attrs_name)):</span><br><span class="line">		allattrs[attrs_name[k]]=attrs_value[k]</span><br><span class="line"></span><br><span class="line">	info=OrderedDict()  <span class="hljs-comment">#存放该商品所具有的全部信息</span></span><br><span class="line">	<span class="hljs-comment">#下面三条语句获取描述、服务、物流的评分信息</span></span><br><span class="line">	<span class="hljs-keyword">if</span> len(dd_value)&gt;<span class="hljs-number">0</span>:</span><br><span class="line">		info[<span class="hljs-string">'描述'</span>]=dd_value[<span class="hljs-number">0</span>]</span><br><span class="line">		info[<span class="hljs-string">'服务'</span>]=dd_value[<span class="hljs-number">1</span>]</span><br><span class="line">		info[<span class="hljs-string">'物流'</span>]=dd_value[<span class="hljs-number">2</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'描述'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">		info[<span class="hljs-string">'服务'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">		info[<span class="hljs-string">'物流'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">#下面的语句用来判断该商品具有哪些属性，如果具有该属性，将属性值插入有序字典，否则，该属性值为空</span></span><br><span class="line">	<span class="hljs-comment">#适用场景</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用场景'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用场景'</span>]=allattrs[<span class="hljs-string">'适用场景'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用场景'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#适用对象</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用对象'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用对象'</span>]=allattrs[<span class="hljs-string">'适用对象'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用对象'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#款式</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'款式'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'款式'</span>]=allattrs[<span class="hljs-string">'款式'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'款式'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#尺码</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'尺码'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'尺码'</span>]=allattrs[<span class="hljs-string">'尺码'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'尺码'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#帽顶款式</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'帽顶款式'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'帽顶款式'</span>]=allattrs[<span class="hljs-string">'帽顶款式'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'帽顶款式'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#帽檐款式</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'帽檐款式'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'帽檐款式'</span>]=allattrs[<span class="hljs-string">'帽檐款式'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'帽檐款式'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#檐形</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'檐形'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'檐形'</span>]=allattrs[<span class="hljs-string">'檐形'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'檐形'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#主要材质</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'主要材质'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'主要材质'</span>]=allattrs[<span class="hljs-string">'主要材质'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'主要材质'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#人群</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'人群'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'人群'</span>]=allattrs[<span class="hljs-string">'人群'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'人群'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#品牌</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'品牌'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'品牌'</span>]=allattrs[<span class="hljs-string">'品牌'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'品牌'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#风格</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'风格'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'风格'</span>]=allattrs[<span class="hljs-string">'风格'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'风格'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#款式细节</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'款式细节'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'款式细节'</span>]=allattrs[<span class="hljs-string">'款式细节'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'款式细节'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#颜色分类</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'颜色分类'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'颜色分类'</span>]=allattrs[<span class="hljs-string">'颜色分类'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'颜色分类'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#适用季节</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用季节'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用季节'</span>]=allattrs[<span class="hljs-string">'适用季节'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用季节'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#适用年龄</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用年龄'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用年龄'</span>]=allattrs[<span class="hljs-string">'适用年龄'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用年龄'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> info</span><br></pre></td></tr></table></figure>

<p>　　抓取天猫商品详情的代码如下：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getTmallDetails</span><span class="hljs-params">(url)</span>:</span></span><br><span class="line">	<span class="hljs-keyword">import</span> requests</span><br><span class="line">	<span class="hljs-keyword">import</span> re</span><br><span class="line">	<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup</span><br><span class="line">	<span class="hljs-comment"># from pandas import DataFrame</span></span><br><span class="line">	<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict</span><br><span class="line">	res=requests.get(url)</span><br><span class="line">	soup=BeautifulSoup(res.text,<span class="hljs-string">"html.parser"</span>)</span><br><span class="line">	<span class="hljs-comment"># dt=soup.select(".tb-shop-rate dt") #获取描述、服务、物流的文本信息，该信息存放在一个列表，需要使用正则表达式提取</span></span><br><span class="line">	dd=soup.select(<span class="hljs-string">".shop-rate ul li"</span>) <span class="hljs-comment">#获取描述、服务、物流的数字信息，该信息存放在一个列表，需要使用正则表达式提取</span></span><br><span class="line">	<span class="hljs-comment"># dt_name=[]</span></span><br><span class="line">	dd_value=[]</span><br><span class="line">	<span class="hljs-comment"># for t in range(0,3):</span></span><br><span class="line">	<span class="hljs-comment"># 	dt_name.append(dt[t].text)</span></span><br><span class="line">	<span class="hljs-keyword">if</span> len(dd)&gt;<span class="hljs-number">0</span>:</span><br><span class="line">		<span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> dd:</span><br><span class="line">			dd_value.append(re.search(<span class="hljs-string">r'([0-9][.][0-9])'</span>,d.text).group())</span><br><span class="line">	<span class="hljs-comment">#下面的语句获取属性列表</span></span><br><span class="line">	attrs=soup.select(<span class="hljs-string">'#J_AttrUL li'</span>)</span><br><span class="line">	attrs_name=[]</span><br><span class="line">	attrs_value=[]</span><br><span class="line">	<span class="hljs-keyword">for</span> attr <span class="hljs-keyword">in</span> attrs:</span><br><span class="line">		attrs_name.append(re.search(<span class="hljs-string">r'(.*?):[\s]*(.*)'</span>,attr.text).group(<span class="hljs-number">1</span>))</span><br><span class="line">		attrs_value.append(re.search(<span class="hljs-string">r'(.*?):[\s]*(.*)'</span>,attr.text).group(<span class="hljs-number">2</span>))</span><br><span class="line"></span><br><span class="line">	allattrs=OrderedDict() <span class="hljs-comment">#存放该产品详情页面所具有的属性</span></span><br><span class="line">	<span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(attrs_name)):</span><br><span class="line">		allattrs[attrs_name[k]]=attrs_value[k]</span><br><span class="line"></span><br><span class="line">	info=OrderedDict()  <span class="hljs-comment">#存放该商品所具有的全部信息</span></span><br><span class="line">	<span class="hljs-comment">#下面三条语句获取描述、服务、物流的评分信息</span></span><br><span class="line">	<span class="hljs-keyword">if</span> len(dd_value)&gt;<span class="hljs-number">0</span>:</span><br><span class="line">		info[<span class="hljs-string">'描述'</span>]=dd_value[<span class="hljs-number">0</span>]</span><br><span class="line">		info[<span class="hljs-string">'服务'</span>]=dd_value[<span class="hljs-number">1</span>]</span><br><span class="line">		info[<span class="hljs-string">'物流'</span>]=dd_value[<span class="hljs-number">2</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'描述'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">		info[<span class="hljs-string">'服务'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">		info[<span class="hljs-string">'物流'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#下面的语句用来判断该商品具有哪些属性，如果具有该属性，将属性值插入有序字典，否则，该属性值为空</span></span><br><span class="line">	<span class="hljs-comment">#适用场景</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用场景'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用场景'</span>]=allattrs[<span class="hljs-string">'适用场景'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用场景'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#适用对象</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用对象'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用对象'</span>]=allattrs[<span class="hljs-string">'适用对象'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用对象'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#款式</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'款式'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'款式'</span>]=allattrs[<span class="hljs-string">'款式'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'款式'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#尺码</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'尺码'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'尺码'</span>]=allattrs[<span class="hljs-string">'尺码'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'尺码'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#帽顶款式</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'帽顶款式'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'帽顶款式'</span>]=allattrs[<span class="hljs-string">'帽顶款式'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'帽顶款式'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#帽檐款式</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'帽檐款式'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'帽檐款式'</span>]=allattrs[<span class="hljs-string">'帽檐款式'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'帽檐款式'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#檐形</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'檐形'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'檐形'</span>]=allattrs[<span class="hljs-string">'檐形'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'檐形'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#主要材质</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'主要材质'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'主要材质'</span>]=allattrs[<span class="hljs-string">'主要材质'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'主要材质'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#人群</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'人群'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'人群'</span>]=allattrs[<span class="hljs-string">'人群'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'人群'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#品牌</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'品牌'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'品牌'</span>]=allattrs[<span class="hljs-string">'品牌'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'品牌'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#风格</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'风格'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'风格'</span>]=allattrs[<span class="hljs-string">'风格'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'风格'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#款式细节</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'款式细节'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'款式细节'</span>]=allattrs[<span class="hljs-string">'款式细节'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'款式细节'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#颜色分类</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'颜色分类'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'颜色分类'</span>]=allattrs[<span class="hljs-string">'颜色分类'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'颜色分类'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#适用季节</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用季节'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用季节'</span>]=allattrs[<span class="hljs-string">'适用季节'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用季节'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line">	<span class="hljs-comment">#适用年龄</span></span><br><span class="line">	<span class="hljs-keyword">if</span> <span class="hljs-string">'适用年龄'</span> <span class="hljs-keyword">in</span> attrs_name:</span><br><span class="line">		info[<span class="hljs-string">'适用年龄'</span>]=allattrs[<span class="hljs-string">'适用年龄'</span>]</span><br><span class="line">	<span class="hljs-keyword">else</span>:</span><br><span class="line">		info[<span class="hljs-string">'适用年龄'</span>]=<span class="hljs-string">'NA'</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> info</span><br></pre></td></tr></table></figure>

<p>最后，将所获取的信息合并在一起，输出为Excel：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">url_start=<span class="hljs-string">'https://item.taobao.com/item.htm?id='</span></span><br><span class="line">	info_df=DataFrame()</span><br><span class="line">	<span class="hljs-keyword">for</span> id <span class="hljs-keyword">in</span> nid_list:</span><br><span class="line">		url_detail=url_start+str(id)</span><br><span class="line">		res=requests.get(url_detail)</span><br><span class="line">		<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isnull(re.search(<span class="hljs-string">'tmall'</span>,res.url)):</span><br><span class="line">			detial=getTmallDetails(url_detail)</span><br><span class="line">		<span class="hljs-keyword">else</span>:</span><br><span class="line">			detial=getTaoBaoDetails(url_detail)</span><br><span class="line">		detial[<span class="hljs-string">'商品id'</span>]=id</span><br><span class="line">		info_df=info_df.append(detial,ignore_index=<span class="hljs-keyword">True</span>)</span><br><span class="line">	writer2=ExcelWriter(<span class="hljs-string">"detail.xlsx"</span>)</span><br><span class="line">	info_df.to_excel(writer2,<span class="hljs-string">"Sheet1"</span>)</span><br><span class="line">	writer2.save()</span><br></pre></td></tr></table></figure>

<p>上述代码应该与第一部分的代码合并在一起，这样会同时输出两个Excel，如果每10个页面输出一次，则需要对输出的Excel重命名，否则下一次输出会覆盖前一次的数据。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-31T16:00:00.000Z">2018-04-01</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 读完 (大约 1312 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/01/mapreduce-LR/">MapReduce计算线性回归的系数</a>
            
        </h1>
        <div class="content">
            <h2 id="先修知识"><a href="#先修知识" class="headerlink" title="先修知识"></a>先修知识</h2><p>设多元线性回归方程的模型为</p>
<p>$$Y=\beta_0+\beta_1X_1+\beta_2X_2+\cdots+\beta_pX_p $$</p>
<p>可令$X_0=1$，则模型可写做：</p>
<p>$$Y=\beta_0X_0+\beta_1X_1+\beta_2X_2+\cdots+\beta_pX_p $$</p>
<p>表示成矩阵形式为：</p>
<p>$$Y=\beta X$$</p>
<p>其中，</p>
<p>$$\beta =<br>\left[\begin{matrix}<br>\beta_0 \<br>\beta_1 \<br>\beta_2 \<br>\vdots \<br>\beta_p<br>\end{matrix}<br>\right]<br>X=<br>\left[\begin{matrix}<br>&amp;x_{10} &amp;x_{11} &amp;\cdots &amp;x_{1p} \<br>&amp;x_{20} &amp;x_{21} &amp;\cdots &amp;x_{2p} \<br>&amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots \<br>&amp;x_{n0} &amp;x_{n1} &amp;\cdots &amp;x_{np}<br>\end{matrix}\right]<br>$$</p>
<p>则线性回归方程的最小二乘系数估计值为:</p>
<p>$$\hat{\beta} = (X’X)^{-1}X’Y$$</p>
<h2 id="编程思路"><a href="#编程思路" class="headerlink" title="编程思路"></a>编程思路</h2><p>利用MapReduce计算系数是，由于输入数据是一行一行进行读取的，因此在计算的时候，不可能直接利用矩阵乘法进行计算。这里，我们假设输入的数据格式为：</p>
<p>$$x_0\ x_1\ x_2\ \cdots x_p\ y$$</p>
<p>即</p>
<p>$$1\  x_1\ x_2\ \cdots x_p\ y$$</p>
<p>首先，考虑最简单的，计算$X’Y$，即计算</p>
<p>$$<br>\left[\begin{matrix}<br>&amp;x_{10} &amp;x_{20} &amp;x_{30} &amp;\cdots &amp;x_{n0} \<br>&amp;x_{11} &amp;x_{21} &amp;x_{31} &amp;\cdots &amp;x_{n1} \<br>&amp;x_{12} &amp;x_{22} &amp;x_{32} &amp;\cdots &amp;x_{n2} \<br>&amp;\vdots &amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots \<br>&amp;x_{1p} &amp;x_{2p} &amp;x_{3p} &amp;\cdots &amp;x_{np}<br>\end{matrix}\right] \times<br>\left[\begin{matrix}<br>        y_1 \<br>        y_2 \<br>        y_3 \<br>        \vdots \<br>        y_n<br>    \end{matrix}\right]=\left[\begin{matrix}<br>        &amp;x_{10}y_1+&amp;x_{20}y_2+&amp;x_{30}y_3+&amp;\cdots+&amp;x_{n0}y_n \<br>        &amp;x_{11}y_1+&amp;x_{21}y_2+&amp;x_{31}y_3+&amp;\cdots+&amp;x_{n1}y_n \<br>        &amp;x_{12}y_1+&amp;x_{22}y_2+&amp;x_{32}y_3+&amp;\cdots+&amp;x_{n2}y_n \<br>        &amp;\vdots &amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots \<br>        &amp;x_{1p}y_1+&amp;x_{2p}y_2+&amp;x_{3p}y_3+&amp;\cdots+&amp;x_{np}y_n<br>        \end{matrix}\right]<br>$$</p>
<p>观察右侧矩阵可以发现，$y_1$总是与第一列相乘，$y_2$总是与第二列相乘，……，以此类推。而第一列实际上就是我们读取数据的第一行，第二列是读取数据的第二行……。根据这种规律，我们每读取一行，就让当前的$y$与所有的自变量相乘，然后把所有的结果累加求和，即为我们想要的结果。</p>
<p>上面已经解决了矩阵自变量矩阵的转置与因变量向量的乘积，即：</p>
<p>$$part1 = X’Y$$</p>
<p>那么，矩阵转置与矩阵的乘积$X’X$仍然可以仿照上述的方法进行。</p>
<p>$$X’X = \left[\begin{matrix}<br>&amp;x_{10} &amp;x_{20} &amp;x_{30} &amp;\cdots &amp;x_{n0} \<br>&amp;x_{11} &amp;x_{21} &amp;x_{31} &amp;\cdots &amp;x_{n1} \<br>&amp;x_{12} &amp;x_{22} &amp;x_{32} &amp;\cdots &amp;x_{n2} \<br>&amp;\vdots &amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots \<br>&amp;x_{1p} &amp;x_{2p} &amp;x_{3p} &amp;\cdots &amp;x_{np}<br>\end{matrix}\right]<br>\times\left[\begin{matrix}<br>&amp;x_{10} &amp;x_{11} &amp;\cdots &amp;x_{1p} \<br>&amp;x_{20} &amp;x_{21} &amp;\cdots &amp;x_{2p} \<br>&amp;x_{30} &amp;x_{31} &amp;\cdots &amp;x_{2p} \<br>&amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots \<br>&amp;x_{n0} &amp;x_{n1} &amp;\cdots &amp;x_{np}<br>\end{matrix}<br>\right]<br>$$</p>
<p>$$=\left[\begin{matrix}<br>&amp;x_{10} &amp;x_{20} &amp;x_{30} &amp;\cdots &amp;x_{n0} \<br>&amp;x_{11} &amp;x_{21} &amp;x_{31} &amp;\cdots &amp;x_{n1} \<br>&amp;x_{12} &amp;x_{22} &amp;x_{32} &amp;\cdots &amp;x_{n2} \<br>&amp;\vdots &amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots \<br>&amp;x_{1p} &amp;x_{2p} &amp;x_{3p} &amp;\cdots &amp;x_{np}<br>\end{matrix}\right]\times\left[\begin{matrix}<br>x_0, x_1, x_2, \cdots, x_p<br>\end{matrix}\right]<br>$$</p>
<p>可以把上述既然课程看作是进行了$p+1$次的矩阵转置与向量乘积过程。当读取第一行时，我们可以得到一个矩阵：</p>
<p>$$<br>step1 = \left[\begin{matrix}<br>        &amp;x_{10}x_{10} &amp;x_{11}x_{10} &amp;\cdots &amp;x_{1p}x_{10} \<br>        &amp;x_{10}x_{11} &amp;x_{11}x_{11} &amp;\cdots &amp;x_{1p}x_{11} \<br>        &amp;x_{10}x_{12} &amp;x_{11}x_{12} &amp;\cdots &amp;x_{1p}x_{12} \<br>        &amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots                   \<br>        &amp;x_{10}x_{1p} &amp;x_{11}x_{1p} &amp;\cdots &amp;x_{1p}x_{1p}<br>    \end{matrix}\right]$$<br>同理，当读取第二行的时候，同样可以得到一个矩阵：</p>
<p>$$<br>step2 = \left[<br>    \begin{matrix}<br>        &amp;x_{20}x_{20} &amp;x_{21}x_{20} &amp;\cdots &amp;x_{2p}x_{20} \<br>        &amp;x_{20}x_{21} &amp;x_{21}x_{21} &amp;\cdots &amp;x_{2p}x_{21} \<br>        &amp;x_{20}x_{22} &amp;x_{21}x_{12} &amp;\cdots &amp;x_{2p}x_{12} \<br>        &amp;\vdots &amp;\vdots &amp;\ddots &amp;\vdots                   \<br>        &amp;x_{20}x_{2p} &amp;x_{21}x_{2p} &amp;\cdots &amp;x_{2p}x_{2p}<br>    \end{matrix}\right]$$</p>
<p>此时，将$step1\ step2$对应元素相加，即得到我们的更新矩阵。迭代下去，最终读取完所在的数据，即为$X’X$的结果。</p>
<p>当数据量很大的时候，用MapReduce方法进行计算，hadoop会将数据按照block的大小切分成若干块，每一块都执行mapper函数，在reducer里面把所有的mapper结果加起来，最后计算$(X’X)^{-1}X’Y$.</p>
<h2 id="编程实现"><a href="#编程实现" class="headerlink" title="编程实现"></a>编程实现</h2><p>由于矩阵的输出不容易处理，因此在得到矩阵的时候，可以将其拉长为向量，这样就可以使用标准化输出函数print将计算结果输出，以便于reducer使用。</p>
<p>mapper函数如下：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#! /usr/bin/anaconda2/bin/python</span></span><br><span class="line"><span class="hljs-comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> sys</span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_input</span><span class="hljs-params">(file)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file:</span><br><span class="line">        <span class="hljs-keyword">yield</span> line.strip()</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">matmulti</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    input = read_input(sys.stdin)</span><br><span class="line"></span><br><span class="line">    innerLength = <span class="hljs-number">0</span></span><br><span class="line">    length = <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> input:</span><br><span class="line">        fields = line.split(<span class="hljs-string">","</span>)</span><br><span class="line">        <span class="hljs-keyword">if</span> innerLength == <span class="hljs-number">0</span>:</span><br><span class="line">            innerLength = len(fields) - <span class="hljs-number">1</span></span><br><span class="line">            data1 = np.array([<span class="hljs-number">0.0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(innerLength)])</span><br><span class="line">        temp = np.array(fields,float)[:innerLength]*float(fields[innerLength])</span><br><span class="line">        data1 = data1 + temp</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">if</span> length == <span class="hljs-number">0</span>:</span><br><span class="line">            length = len(fields) - <span class="hljs-number">1</span></span><br><span class="line">            data2 = np.diag(np.zeros(length))</span><br><span class="line">        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> range(length):</span><br><span class="line">            data2[index] += np.array(fields[:length],dtype = float)*float(fields[index])</span><br><span class="line">            </span><br><span class="line">    <span class="hljs-keyword">return</span> data1,data2</span><br><span class="line"></span><br><span class="line">data1,data2 = matmulti()</span><br><span class="line">data1 = list(data1)</span><br><span class="line">length = len(data2)</span><br><span class="line">data2 = data2.reshape(<span class="hljs-number">1</span>,length**<span class="hljs-number">2</span>)</span><br><span class="line">data2 = list(data2[<span class="hljs-number">0</span>])</span><br><span class="line">data = data1 + data2</span><br><span class="line">print(<span class="hljs-string">"\t"</span>.join(str(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data))</span><br></pre></td></tr></table></figure>

<p>reducer函数如下：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#! /usr/bin/anaconda2/bin/python</span></span><br><span class="line"><span class="hljs-comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> sys</span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_input</span><span class="hljs-params">(file)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file:</span><br><span class="line">        <span class="hljs-keyword">yield</span> line.strip()</span><br><span class="line"></span><br><span class="line">input = read_input(sys.stdin)</span><br><span class="line"></span><br><span class="line">length = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> input:</span><br><span class="line">    fields = line.split(<span class="hljs-string">"\t"</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> length == <span class="hljs-number">0</span>:</span><br><span class="line">        length = len(fields)</span><br><span class="line">        data = np.array([<span class="hljs-number">0.0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(length)])</span><br><span class="line">    fields = np.array(fields,dtype = float)</span><br><span class="line">    data += fields</span><br><span class="line"></span><br><span class="line">lenght = len(data)</span><br><span class="line">varnums = int((<span class="hljs-number">-1</span>+math.sqrt(<span class="hljs-number">1</span>+<span class="hljs-number">4.0</span>*length))/<span class="hljs-number">2.0</span>)</span><br><span class="line"></span><br><span class="line">part1 = np.mat(data[:varnums])</span><br><span class="line">part1 = part1.T</span><br><span class="line"></span><br><span class="line">part2 = data[varnums:]</span><br><span class="line">part2 = part2.reshape(varnums,varnums)</span><br><span class="line">part2 = np.mat(part2)</span><br><span class="line">part2 = part2.I</span><br><span class="line"></span><br><span class="line">result = part2*part1</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">print</span> result</span><br></pre></td></tr></table></figure>

<p>用R随机生成一份样本量为100万的数据，R回归结果为：</p>
<figure class="highlight r hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Coefficients:</span><br><span class="line">              Estimate Std. Error t value Pr(&gt;|t|)    </span><br><span class="line">(Intercept) <span class="hljs-number">19.9995945</span>  <span class="hljs-number">0.0602316</span> <span class="hljs-number">332.045</span>   &lt;<span class="hljs-number">2e-16</span> ***</span><br><span class="line">V2          -<span class="hljs-number">0.0012168</span>  <span class="hljs-number">0.0009998</span>  -<span class="hljs-number">1.217</span>   <span class="hljs-number">0.2236</span>    </span><br><span class="line">V3          -<span class="hljs-number">0.0018043</span>  <span class="hljs-number">0.0009990</span>  -<span class="hljs-number">1.806</span>   <span class="hljs-number">0.0709</span> .  </span><br><span class="line">V4           <span class="hljs-number">0.0017635</span>  <span class="hljs-number">0.0009990</span>   <span class="hljs-number">1.765</span>   <span class="hljs-number">0.0775</span> .  </span><br><span class="line">V5          -<span class="hljs-number">0.0021161</span>  <span class="hljs-number">0.0009987</span>  -<span class="hljs-number">2.119</span>   <span class="hljs-number">0.0341</span> *  </span><br><span class="line">V6          -<span class="hljs-number">0.0002982</span>  <span class="hljs-number">0.0009997</span>  -<span class="hljs-number">0.298</span>   <span class="hljs-number">0.7655</span>    </span><br><span class="line">V7           <span class="hljs-number">0.0008608</span>  <span class="hljs-number">0.0009998</span>   <span class="hljs-number">0.861</span>   <span class="hljs-number">0.3892</span>    </span><br><span class="line">V8           <span class="hljs-number">0.0007678</span>  <span class="hljs-number">0.0009995</span>   <span class="hljs-number">0.768</span>   <span class="hljs-number">0.4423</span>    </span><br><span class="line">V9           <span class="hljs-number">0.0009089</span>  <span class="hljs-number">0.0009991</span>   <span class="hljs-number">0.910</span>   <span class="hljs-number">0.3630</span>    </span><br><span class="line">V10          <span class="hljs-number">0.0009761</span>  <span class="hljs-number">0.0009991</span>   <span class="hljs-number">0.977</span>   <span class="hljs-number">0.3286</span></span><br></pre></td></tr></table></figure>

<p>MapReduce的输出结果为：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[[  <span class="hljs-number">1.99995945e+01</span>]	</span><br><span class="line"> [ <span class="hljs-number">-1.21684122e-03</span>]	</span><br><span class="line"> [ <span class="hljs-number">-1.80428969e-03</span>]	</span><br><span class="line"> [  <span class="hljs-number">1.76352620e-03</span>]	</span><br><span class="line"> [ <span class="hljs-number">-2.11610460e-03</span>]	</span><br><span class="line"> [ <span class="hljs-number">-2.98208998e-04</span>]	</span><br><span class="line"> [  <span class="hljs-number">8.60846240e-04</span>]	</span><br><span class="line"> [  <span class="hljs-number">7.67848910e-04</span>]	</span><br><span class="line"> [  <span class="hljs-number">9.08866936e-04</span>]	</span><br><span class="line"> [  <span class="hljs-number">9.76052909e-04</span>]]</span><br></pre></td></tr></table></figure>

<p>二者的计算结果是一样的。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-31T09:56:45.000Z">2018-03-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 读完 (大约 0 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/31/小札-1/">小札-1</a>
            
        </h1>
        <div class="content">
            
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-30T14:54:51.000Z">2018-03-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/大数据/">大数据</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 读完 (大约 0 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/30/Introduction-to-ETL/">Introduction to ETL</a>
            
        </h1>
        <div class="content">
            
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-27T15:27:20.000Z">2018-03-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/NLP/">NLP</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 读完 (大约 10657 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/27/词向量/">Word2Vec-语言模型的前世今生</a>
            
        </h1>
        <div class="content">
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p><img src="/picture/feeding.jpg" alt="picture"></p>
<p>在机器学习领域，语言识别和图像识别都比较容易做到。语音识别的输入数据可以是音频频谱序列向量所构成的matrix，图像识别的输入数据是像素点向量构成的矩阵。但是文本是一种抽象的东西，显然不能直接把文本数据喂给机器当做输入，因此这里就需要对文本数据进行处理。</p>
<p>现在，有这么一个有趣的例子，我接下来要讲的模型就可以做到。</p>
<ul>
<li>首先给出一个例子，Paris - France + America = ?</li>
</ul>
<p>从我们人的角度来看,Paris是法国的首都，那么首都减去国家再加上一个国家，很可能表示的就是另一个国家的首都。因此这里的结果就是华盛顿Washington.机器想做到这一点，并不容易。</p>
<ul>
<li><p>众所周知，只有标量或者向量可以应用加减法，抽象的自然语言该如何做到呢？</p>
</li>
<li><p>一个很自然的想法就是，自然语言能否表示成数学的形式，这样就可以更加方便地研究其规律了。</p>
</li>
<li><p>答案是肯定的。</p>
</li>
</ul>
<p>现在我们可以进行思考，如何将文本中的词语用数学的形式表达出来,也就是说，文本中藏着哪些数学形式需要我们去挖掘。</p>
<ol>
<li><p>文本中各个词语出现的频数是有限的，这是一个可以提取的数学形式</p>
</li>
<li><p>从逻辑的角度出发，词语之间不可能是独立的，一个词语的出现肯定与另一个或者若干个词语有关系。这就涉及到词语共现的层面了。</p>
</li>
</ol>
<p>统计语言模型和大多数的词向量表示都是基于以上两点考虑的。</p>
<p>词向量的表现形式主要分为两种，一种是one-hot(one-hot representation)表示方式，将词表示成一个很长的向量，向量的长度就是词典的长度；另一种表示方法是分布式表示(distributed representation).同时，分布式表示方法又可以分为基于矩阵的表示方法、基于聚类的表示方法和基于神经网络的表示方法。</p>
<p>首先，最简单的就是one-hot表示方法，将词表示成一个很长的向量，向量的分量只有一个1，其他全为0，1所对应的位置就是该词在词汇表中的索引。</p>
<p>这样表示有两个缺点：</p>
<ol>
<li><p>容易受维度灾难(the curse of dimentionality)的困扰；</p>
</li>
<li><p>没有考虑到词之间的关系(similarity)。</p>
</li>
</ol>
<p>现在主要应用的都是分布式表示形式了。下面介绍一种简单的分布式表示形式——基于矩阵的表示形式。</p>
<p>如下表所示：</p>
<table>
<thead>
<tr>
<th>Probability and Ratio</th>
<th>k = solid</th>
<th>k = gas</th>
<th>k = water</th>
<th>k = fashion</th>
</tr>
</thead>
<tbody><tr>
<td>$p(k\vert ice)$</td>
<td>$1.9\times 10^{-4}$</td>
<td>$6.6\times 10^{-5}$</td>
<td>$3.0\times 10^{-3}$</td>
<td>$1.7\times 10^{-5}$</td>
</tr>
<tr>
<td>$p(k\vert steam$)</td>
<td>$2.2\times 10^{-5}$</td>
<td>$7.8\times 10^{-4}$</td>
<td>$2.2\times 10^{-3}$</td>
<td>$1.8\times 10^{-5}$</td>
</tr>
<tr>
<td>$p(k\vert ice)/(p(k\vert steam)$</td>
<td>$8.9$</td>
<td>$8.5\times 10^{-2}$</td>
<td>$1.36$</td>
<td>$0.96$</td>
</tr>
</tbody></table>
<p>简单说一下上面的矩阵。</p>
<p>假设我们对一些热力学短语或者词语的概念感兴趣，我们选择i=ice，k=steam，我们想看看ice和steam的关系，可以通过他们与其他词语的共现频率来研究。这些其他词语我们称之为探测词。这里我们选择探测词k为solid，gas，water和fashion。显然，ice与solid的相关性较高，但是与steam相关性较低，因此我们期望看到的是$p_{ik}/p_{jk}$比值比较大。对于探测词gas，我们期望看到的是$p_{ik}/p_{jk}$比值比较小。而water和fashion与ice和steam的关系要么都十分密切，要么都不怎么密切，因此对于这两个探测词，$p_{ik}/p_{jk}$应该接近于1.</p>
<p>上表是基于一个很大的语料库统计得出的，符合我们的预期。相比于单独使用原始概率，概率比值可以更好的区分相关词语和不相关词语，比如solid和gas与water和fashion；也可以很容易区分两个相关词。</p>
<p>那么，在正式介绍自然语言处理，或者说wrod2vec之前，有必要介绍以下统计语言模型。它是现在所有语言模型的基础。</p>
<p>第二个需要讲的分布式表示方式是基于神经网络的表示方法。在此之前，有必要讲一下传统的统计语言模型，毕竟它对语言模型影响深远。</p>
<hr>
<h2 id="统计语言模型"><a href="#统计语言模型" class="headerlink" title="统计语言模型"></a>统计语言模型</h2><h3 id="1-引言"><a href="#1-引言" class="headerlink" title="1. 引言"></a>1. 引言</h3><p>给出以下三个句子：</p>
<pre><code>美联储主席本·伯南克昨天告诉媒体7000亿美元的救助资金将借给上百家银行、保险公司和汽车公司

美主席联储本·伯南克告诉昨天媒体7000亿美元的资金救助将借给百上家银行、保险公司和汽公车司

美主车席联储本·克告诉昨天公司媒体7000伯南亿美行元的金将借给百救助上家资银、保险公司和汽</code></pre><p>对于第一个句子，语句通畅，意思也很不明白；对于第二个句子，虽然个别词语调换了位置，但也不影响阅读，我们仍然能够知道表达的是什么意思；对于第三个句子，我们就很难知道具体表示什么意思了。</p>
<p>如果问你为什么第三个句子不知道表达什么，你可能会说句子混乱，语义不清晰。在上个世纪70年代的时候，科学家们也是这样想的，并且试图让计算机去判断一个句子的语义是否清晰，然而，这样的方法是走不通的。</p>
<p><strong>贾里尼克</strong>想到了一种很好的统计模型来解决上述问题。判断一个句子是否合理，只需要看它在所有句子中出现的概率就行了。第一个句子出现的概率大概是$10^{-20}$,第二个句子出现的概率大概是$10^{-25}$，第三个句子出现的概率大概是$10^{-70}$，第一个句子出现的可能性最大，因此这个句子最为合理。</p>
<p>那么，如何计算一个句子出现的概率呢，我们可以把有史以来人类说过的话都统计一遍，这样就能很方便的计算概率了。然而，你我都知道这条路走不通。</p>
<p>假设想知道S在文本中出现的可能性，也就是数学上所说的S的概率，既然$S=w_1,w_2,…,w_n$,那么不妨把S展开表示，</p>
<p>$$P(S)=P(w_1,w_2,…,w_n)$$</p>
<p>利用条件概率的公式，S这个序列出现的概率等于每一个词出现的条件概率的乘乘积，展开为：</p>
<p>$$<br>P(w_1,w_2,…,w_n)=P(w_1)P(w_2\vert w_1)P(w_3\vert w_1,w_2)\cdots P(w_n\vert w_1,w_2,\cdots w_{n-1})<br>$$</p>
<p>计算$P(w_1)$很容易，$P(w_2\vert w_1)$也还能算出来，$P(w_3\vert w_1,w_2)$已经非常难以计算了。</p>
<h3 id="2-偷懒的马尔科夫-Andrey-Markov"><a href="#2-偷懒的马尔科夫-Andrey-Markov" class="headerlink" title="2. 偷懒的马尔科夫(Andrey Markov)"></a>2. 偷懒的<strong>马尔科夫</strong>(Andrey Markov)</h3><p>假设上面的n不取很长，而只取2个，那么就可以大大减少计算量。即在此时，假设一个词$w_i$出现的概率只与它前面的$w_{i-1}$有关，这种假设称为1阶马尔科夫假设。</p>
<p>现在，S的概率就变得简单了：<br>$$<br>P(w_1,w_2,…,w_n) \approx P(w_1)P(w_2\vert w_1)<br>$$ </p>
<p>那么，接下来的问题就变成了估计条件概率$P(w_i\vert w_{i-1})$,根据它的定义，</p>
<p>$$<br>P(w_i\vert w_{i-1}) = \frac{P(w_i,w_{i-1})}{P(w_{i-1})}<br>$$<br>,</p>
<p>当样本量很大的时候，基于大数定律，一个短语或者词语出现的概率可以用其频率来表示，即<br>$$<br>P(w_i,w_{i-1})\approx \frac{count(w_i,w_{i-1})}{count(*)}<br>$$</p>
<p>$$<br>P(w_{i-1}) \approx \frac{count(w_{i-1})}{count(*)}<br>$$</p>
<p>其中，$count(i)$表示词$i$出现的次数，$count$表示语料库的大小。</p>
<p>那么</p>
<p>$$<br>P(w_i\vert w_{i-1}) = \frac{P(w_i,w_{i-1})}{P(w_{i-1})} \approx \frac{count(w_i,w_{i-1})}{count(w_{i-1})}<br>$$</p>
<h3 id="3-高阶语言模型"><a href="#3-高阶语言模型" class="headerlink" title="3. 高阶语言模型"></a>3. 高阶语言模型</h3><p>在前面的模型中，每个词只与前面1个词有关，和更前面的词就没有关系了，这似乎简单的有点过头了。那么，假定每个词$w_i$都与前面的N-1个词有关，而与更前面的词无关，这样，当前词的概率只取决于前面N-1个词的联合概率，即</p>
<p>$$<br>P(w_1\vert w_1,w_2,\cdots w_{i-1}) \approx P(w_1\vert w_{i-N+1},w_{i-N+2},\cdots w_{i-1})<br>$$<br>,</p>
<p>上面这种假设被称为n-1阶马尔科夫假设，对应的模型称为N元模型。N=2就是二元模型，N=1其实就是上下文无关的模型，基本不怎么使用。</p>
<p>上面的模型看起来已经很完美了，但是考虑以下两个问题，对于二元模型：</p>
<p>如果此时$count(w_i,w_{i-1})=0$，是否可以说$P(w_i\vert w_{i-1})=0$ ?</p>
<p>如果此时$count(w_i,w_{i-1})=count(w_{i-1})$，是否可以说$P(w_i\vert w_{i-1})=1$ ?</p>
<p>显然，不能这么武断。</p>
<p>但是，实际上上述两种情况肯定是会出现的，尤其是语料足够大的时候，那么，我们怎么解决上述问题呢？</p>
<p>古德和图灵给出了一个很漂亮的重新估计概率的公式，这个公式后来被称为古德-图灵估计。</p>
<p>古德图灵的原理是：</p>
<pre><code>对于没有看见的事件，我们不能认为他发生的概率就是0，因此从概率的总量中，分配一个很小的比例给这些没有看见的事件。这样一来，看见的那些事件的概率就要小于1了，因此，需要将所有看见的事件的概率调小一点。至于小多少，要根据“越是不可信的统计折扣越多”的方法进行。</code></pre><p>假定在语料库中出现$r$次的词有$N_r$个，特别的，未出现的词数量为$N_0$，语料库大小为$N$，那么，很显然，</p>
<p>$$<br>N = \sum _{r=1}^ \infty rN_r<br>$$<br>,</p>
<p>出现$r$次的词在整个语料库中的相对频度则是${rN_r}/{N}$，如果不做任何处理，这个相对频度作为这些词的概率。但是当$r$比较小的时候，统计上可能不可靠，因此需要使用一个更小的次数$d_r$来表示，古德-图灵按照如下公式计算$d_r$:</p>
<p>$$<br>d_r=(r+1)\cdot N_{r+1}/N_r<br>$$<br>,</p>
<p>显然</p>
<p>$$<br>\sum_r d_r\cdot N_r = \sum_r (r+1)\cdot N_{r+1} = N<br>$$<br>,</p>
<p>此时，</p>
<p>$$<br>d_0 = (0+1)\cdot N_1/N_0 = \frac{N_1}{N_0} &gt; 0<br>$$</p>
<p>在实际处理的时候，一般对出现次数超过某个阈值的词，频率不下调。</p>
<p>基于这种思想，估计二元模型概率的公式如下：</p>
<p>$$<br>P(w_i\vert w_{i-1})=<br>\begin{cases}<br>f(wi\vert w_{i-1}) &amp; {if\quad count(w_{i-1},w_i)} \ge T \<br>f_{gt}(w_i\vert w_{i-1})&amp; if\quad 0 \le count(w_{i-1},w_i) &lt; T \<br>Q(w_{i-1})\cdot f(w_i) &amp; otherwise<br>\end{cases}<br>$$<br>,</p>
<p>其中, $f(\cdot)$ 表示相对频度，即频率。</p>
<p>$$<br>Q(w_{i-1})=\frac{1-\sum_{w_i\quad seen}P(w_i \vert w_{i-1})}{\sum _{wi\quad unseen}f(w_i)}<br>$$</p>
<p>上面这种方法称为卡茨退避法。</p>
<p>n-gram模型的作用就是，基于语料库计算出各种词串出现的概率，遇到一个句子的时候，可以直接使用上面所计算的概率，把所有的概率连乘，就得到了整个句子的概率。</p>
<h3 id="4-机器学习的思想"><a href="#4-机器学习的思想" class="headerlink" title="4. 机器学习的思想"></a>4. 机器学习的思想</h3><p>机器学习的套路是，对所研究的问题建模，构造一个目标函数，然后优化参数，最后用这个目标函数进行预测。</p>
<p>对于统计语言模型，常使用最大对数似然作为目标函数，即</p>
<p>$$<br>L = \sum_{w\in C}logP(w\vert context(w))<br>$$<br>,</p>
<p>在n-gram模型中，$context(w_i) = (w_{i-n+1},w_{i-n+2},\cdots,w_{i-1})$,</p>
<p>由此可见，概率$P(w_i\vert context(w_i))$是关于$w$和$context(w)$的函数，即</p>
<p>$$<br>P(w\vert context(w)) = F(w,context(w),\theta)<br>$$<br>,</p>
<p>一旦$F$确定下来了，任何概率都可以使用这个函数进行计算了。</p>
<p><strong>似乎到这里，我们仍然不知道词向量是什么，因为n-gram模型中根本没有用到词向量。那么，接下来将要介绍的神经网络语言模型则是实实在在用到了词向量。之所以提到统计语言模型，是因为它是其他语言模型的基础，我们得知道语言模型是干嘛的，然后再对语言模型进行展开。</strong></p>
<hr>
<h2 id="神经网络语言模型"><a href="#神经网络语言模型" class="headerlink" title="神经网络语言模型"></a>神经网络语言模型</h2><p>上面介绍的n-gram模型相信我们已经十分清楚了，但是n-gram模型的一个突出的确定就是，n的设置不宜过大，n从2到3提升效果显著，但是从3-4提升的效果就没那么好了。而且随着n的增大，参数的数量是以几何形势增长的。</p>
<p>因此，n-gram模型只能提取某个词前面两到三个词的信息，而不能提取更多的信息了。然而很明显的是，整文本序列中，包含更前面的词能够提供比仅仅2到3个词更多的信息，这也是神经网络语言模型着重要解决的问题之一。</p>
<p>神经网络模型主要在以下两点上寻求更大的进步：</p>
<ol>
<li><p>n-gram模型没有考虑上下文中更多的词提供的信息</p>
</li>
<li><p>n-gram模型没有考虑词与此之间的相似性。</p>
</li>
</ol>
<p><strong>举个栗子：</strong></p>
<p>如果在一个语料库中，”the cat is walking in the bedroom”出现了5000次，而”a dog is running in the room”只出现了5次，n-gram模型得出的结果是前面一个句子的可能性会比后面一个句子大得多。但是实际上，这两个句子是相似的，他们在真实的情况下出现的概率也应该是相仿的。</p>
<p>神经网络语言模型可以概括为以下三点：</p>
<ol>
<li><p>将词汇表中的每个词表示成一个在m维空间里的实数形式的分布式特征向量</p>
</li>
<li><p>使用序列中词语的分布式特征向量来表示连接概率函数</p>
</li>
<li><p>同时学习特征向量和概率函数的参数</p>
</li>
</ol>
<p>特征向量表示词的不同特征：每一个词都是向量空间内的一个点。特征的个数通常都比较小，比如30，60或者100，远远小于词汇表的长度。概率函数是在给定一个词前面的若干词的情况下，该词出现的条件概率。调整概率函数的参数，使得训练集的对数似然达到最大。每个词的特征向量是通过训练得到的，也可以用先验知识进行初始化。</p>
<ul>
<li><p>训练集是词序列$W_1,W_2,…,W_T,W_T\in V$,$V$是词汇表，是一个很大但是有限的集合。</p>
</li>
<li><p>目标是找到一个好的模型，使得$f(W_t,…,W_{t-n+1})=\hat{P}(W_t|W_1^{n-1})$</p>
</li>
<li><p>唯一的约束条件是$\sum <em>{i=1}^{|V|}f(i,W</em>{t-1},…,W_t-n+1)=1,f&gt;0$</p>
</li>
</ul>
<p><img src="/picture/nnlm.png" alt="photo"> </p>
<p>我们将函数$f(W_t,…,W_{t-n+1})$分解为以下两个部分：</p>
<ol>
<li><p>映射$C$，将$V$中的所有元素映射为真实的向量$C(i)\in R^m$，$C(i)$代表词汇表中的每个词的分布式特征向量，实际上，$C$是一个由自由参数构成的$|V|\times m$矩阵。其中$|V|$代表词汇表的大小，也就是词汇表中的词数量。</p>
</li>
<li><p>每个词的概率函数是由$C$来表示的：函数$g$将输入的词特征向量$(C(W_{t-n+1}),…,C(W_{t-1}))$映射为词$W_t$前面$n-1$个词的条件概率分布。</p>
</li>
</ol>
<p>$$<br>f(i,W_{t-1},…,W_{t-n+1})=g(i,C(W_{t-1}),…,C(W_{t-n+1}))$$</p>
<p>函数$f$是由两个映射组成的($C&amp;g$),$C$是所有词共享的。每一个部分都与一些参数有关。</p>
<p>映射$C$的参数实际上就是特征向量本身，表示为一个$|V|\times m$矩阵，矩阵的每一行代表词$i$的特征向量$C(i)$.</p>
<p>函数$g$的参数是$\omega$，所有的参数就是$\theta = (C,\omega)$.</p>
<p>当寻找到使得带惩罚项的训练语料库的对数似然率最大的$\theta$，那么训练完成。</p>
<p>$$<br>L = \frac{1}{T}\sum <em>t log f(W_t,W</em>{t-1},…,W_t-n+1)+R(\theta)<br>$$</p>
<p>$R(\theta)$是惩罚项，只作用于神经网络的权重和矩阵$C$。自由参数的规模是$V$的线性函数，也是$n$的线性函数。</p>
<p>在下面的大多数试验中，神经网络只有一个隐藏层，外加一个映射层。还有一个可选的直连层。所以说实际上有两个隐藏层，但是由于影射层只是做了一个线性变换，并没有添加新的信息，因此不能视为真正的隐藏层。所以真正的隐藏层就只有一个。</p>
<p>从图中可以看出，最底层实际上就是一些单一的词，表示成one-hot形式，即长度为词汇表的长度。然后，每个one-hot向量分别与投影矩阵C相乘，则原来长度为$|V|$的one-hot向量，经过线性变换以后，缩短为一个长度为$m$的向量，其中m就是我们设置的特征的个数，一般在2个数量级。投影完成以后，将所有的特征向量按照顺序首尾相连，形成一个长度为$m(n-1)$的向量，以词向量作为隐藏层的输入，隐藏层的激活函数为双曲正切函数$tanh$。输出层接受隐藏层的输出作为输入，经过一个softmax函数进行转换，得到最终的输出P.</p>
<p>即</p>
<p>$$<br>\hat{P}(w_t\vert w_{t-1},…,w_{t-n+1})=\frac{e^{y_{w_t}}}{\sum_i e^{y_i}}<br>$$<br>,</p>
<p>其中</p>
<p>$$<br>y = b+Wx + Utanh(d+Hx)<br>$$</p>
<p>双曲正切函数逐个应用于隐藏层的各个单元。当没有直连的时候，$W=0$，$x$是首尾相连的特征向量：</p>
<p>$$<br>x = (C(w_{t-1}),C(w_{t-2}),…,C(w_{t-n+1}))<br>$$</p>
<p>令$h$是隐藏层的单元数，$m$是特征向量的长度，当没有直连的时候，$W=0$。那么，所有的自由参数就是：</p>
<ul>
<li><p>输出层的偏置$b$，长度为|V|</p>
</li>
<li><p>隐藏层的偏置$d$，长度为$h$</p>
</li>
<li><p>隐藏层到输出层的权重矩阵$U$,是一个$|V|\times h$矩阵</p>
</li>
<li><p>词向量到输出层的权重矩阵$W$，是一个$|V|\times (n-1)m$矩阵</p>
</li>
<li><p>隐藏层权重$H$，是一个$h\times (n-1)m$矩阵</p>
</li>
<li><p>特征矩阵$C$，是一个$|V|\times m$矩阵</p>
</li>
</ul>
<p><strong>此时的输出$y$实际上是一个长度为$|V|$的向量，那么分量$y_{wt}$不能表示给出前(n-1)个词的情况下$w_t$的概率，因此需要进行一次归一化。</strong></p>
<p>那么，我们所有的参数如下：</p>
<p>$$<br>\theta = (b,d,W,U,H,C)<br>$$</p>
<p>主要的计算量都集中在隐藏层到输出层的以及输出层的归一化计算。</p>
<p>使用随机梯度下降进行参数求解：</p>
<p>$$<br>\theta \leftarrow \theta + \epsilon\frac{\partial log \hat{P}(w_t\vert w_{t-1},w_{t-2},w_{t-n+1})}{\partial \theta}<br>$$</p>
<p>其中，$\epsilon$是学习率。</p>
<p>当训练结束以后，矩阵$C$就是我们需要的词向量，每一行代表该位置的词的向量。得到了词向量，就可以进行许多有趣的分析。</p>
<p>比如：</p>
<ul>
<li><p>文本聚类</p>
</li>
<li><p>计算文本相似度</p>
</li>
<li><p>其他应用</p>
</li>
</ul>
<hr>
<h2 id="Skip-Gram-模型"><a href="#Skip-Gram-模型" class="headerlink" title="Skip-Gram 模型"></a>Skip-Gram 模型</h2><p>基本版的skip-gram模型是十分简单的。我们将会训练一个只有一个隐藏层的简单的神经网络来完成我们的任务，但是当神经网络训练完成以后，我们实际上并不使用这个网络做什么，而是获得隐藏层的权重矩阵，这个矩阵实际上就是我们需要的词向量(word vectors)</p>
<p>skip-gram模型需要完成这样的工作：给定一个词，预测其周围的词，或者说在其附近的词。这个神经网络将会计算出我们从词汇表中选出的每个“候选”邻居词的概率。</p>
<p>这里的附近需要说明一下，实际上在算法里有一个”window size”参数，用来控制窗口大小，如果选择参数的值为5，则会预测该词前后各5个词的概率。</p>
<p>skip-gram模型的输入需要经过特殊的调整，不同于上述神经网络语言模型，应该首先将这里的语料整理成词对(word-pair)。</p>
<p>比如对于语句”The quick brown fox jumps over the lazy dog.”此处我们选择window size = 2.</p>
<p><img src="/picture/3.png" alt="input of skip gram"></p>
<p>具体操作如图所示：</p>
<ul>
<li><p>对于单词”The”，取其前后两个词与其凑成词对，这里”The”前面没有单词，因此取后面两个，凑成两个词对，分别是(the,quick),(the,brown)。</p>
</li>
<li><p>对于单词quick，其前面有1个单词，后面有2个单词，可以凑成3对，分别为：(quick,the),(quick,brown),(quick,fox)。</p>
</li>
<li><p>对于单词brown，其前面有两个单词，后面有两个单词，可以凑成4对，分别是：(brown,the),(brown,quick),(browm,fox),(brown,fox)。</p>
</li>
</ul>
<p>以此类推，可以把语料库中的所有文本调整成上述词对。</p>
<p>所有的词对都应该是(input,output)形式。</p>
<p>有了词对，接下来看一下skip-gram的最简单的模型长什么样子。</p>
<p><img src="/picture/4.png" alt="skip-gram  diagram"></p>
<p>在上图中，可以清晰地看出，skip-gram模型是一个简单的神经网络，有一个隐藏层（实际上在作者的论文中是以投影层的形式表述的），该隐藏层并没有对应的激活函数。</p>
<p>输入数据仍然是one-hot向量，向量只有一个分量是1，其他全为0.向量的长度为词汇表的长度。</p>
<p>对下面所要用的符号进行说明：</p>
<ul>
<li><p>$i$：输入的one-hot向量，长度为|V|</p>
</li>
<li><p>$|V|$：词汇表的长度</p>
</li>
<li><p>$P$：输入层到投影层的$|V|\times m$权重矩阵</p>
</li>
<li><p>$W$：投影层到输出层的$m\times |V|$权重矩阵</p>
</li>
<li><p>$y$：输出层输出结果</p>
</li>
</ul>
<p>由于这个神经网络没有激活函数，因此看起来比较简单。</p>
<p>神经网络的计算过程如下：</p>
<ul>
<li><p>首先，将输入词向量(one-hot)投影到隐藏层(投影层)，即$$<br>i^T\times P=1\times |V|\times |V| \times m=1\times m<br>$$</p>
</li>
<li><p>将隐藏层的结果乘以隐藏层到输出层的权重矩阵$W$，即$$<br>1\times m \times m\times |V|=1\times |V|<br>$$</p>
</li>
<li><p>将输出层的输出结果进行softmax归一化，即</p>
</li>
</ul>
<p>$$y=\frac{e^{y}}{\sum_{i\in y}e^i }$$</p>
<p>此时$y$是一个$1\times |V|$向量，向量的每个分量代表给定词$w_i$的情况下，其相邻词是词汇表中对应词的概率。将$y$与output的one-hot向量相乘，就可以得到给定$w_i$的情况下，其相邻词是output的概率，即</p>
<p>$$<br>P(w_o\vert w_i)=y\times w_o<br>$$<br>,</p>
<p>其中，$w_o$是词output的向量形式。</p>
<p><strong>以上矩阵相乘只是为了说明维度变化，并不是实际上的矩阵乘法。</strong></p>
<p>用矩阵说明如下：</p>
<p>假定我们的词库大小为10，输出层到投影层的权重矩阵为$10\times 4$矩阵。</p>
<p>我们的输入样本是词对(brown,quick).其中，brown的one-hot表示形式如图中的蓝色向量所示，quick的one-hot表示形式如图中的浅绿色向量所示。</p>
<ul>
<li><p>蓝色向量是我们的输入向量，即one-hot向量</p>
</li>
<li><p>黄色矩阵是输入层到投影层的权重矩阵</p>
</li>
<li><p>绿色向量是输入向量与第一个权重矩阵的向量乘积</p>
</li>
<li><p>棕色矩阵是投影层到输出层的权重矩阵</p>
</li>
<li><p>灰色向量是绿色向量与棕色矩阵的矩阵乘积</p>
</li>
<li><p>红色向量是对灰色向量进行了一次$softmax$归一化计算</p>
</li>
<li><p>浅绿色矩阵是词对中的输出词对应的one-hot向量</p>
</li>
<li><p>深红色数值是我们计算出的输出词对应的概率</p>
</li>
</ul>
<p><strong>skip-gram的目标是对于训练样本$w_1,w_2,\cdots,w_T$,最大化如下平均对数似然概率：</strong></p>
<p><img src="/picture/5.jpg" alt="matrix2"></p>
<p>$$<br>\frac{1}{T}\sum <em>{t=1}^T\sum</em>{-c\le i\le c,j\ne 0}log p(w_{t+j}\vert w_t)<br>$$</p>
<p>实际上，以上模型是难以实现的，因为计算 $\nabla logp(w_O\vert w_I)$的代价随着$W$的增大而增大(W表示词汇表的长度),经常达到$10^5-10^7$数量级。</p>
<h2 id="Hierarchical-Softmax"><a href="#Hierarchical-Softmax" class="headerlink" title="Hierarchical Softmax"></a>Hierarchical Softmax</h2><h3 id="哈夫曼树"><a href="#哈夫曼树" class="headerlink" title="哈夫曼树"></a><strong>哈夫曼树</strong></h3><p>哈夫曼树是一种最优二叉树，它是这样定义的：</p>
<pre><code>给定n个权值作为n个叶子结点，构造一棵二叉树，若带权路径长度达到最小，称这样的二叉树为最优二叉树。</code></pre><p>哈夫曼树的构造方法如下：</p>
<p>(1) 将$w_1,w_2,\cdots,w_n$看成是有n 棵树的森林(每棵树仅有一个结点)；</p>
<p>(2) 在森林中选出两个根结点的权值最小的树合并，作为一棵新树的左、右子树，且新树的根结点权值为其左、右子树根结点权值之和；</p>
<p>(3)从森林中删除选取的两棵树，并将新树加入森林；</p>
<p>(4)重复(2)、(3)步，直到森林中只剩一棵树为止，该树即为所求得的哈夫曼树</p>
<p>假设我们的权值为：26    24    15    10    17    18    10    27</p>
<p>首先对上面的权值按照从小到大排序：</p>
<pre><code>排序后的权值为：10 10 15 17 18 24 26 27</code></pre><p>然后。我们按照上述步骤构建哈夫曼树。</p>
<p><strong>此处我们约定将大的权值放在左子树。</strong></p>
<p>—Begin</p>
<ul>
<li><p>选择最小的两个权值10，10，合并成一个新树的左右子树。新树的权值为20，删除合并的两个权值，将20加入到森林，此时的权值为（仍然进行排序）：15 17 18 <strong>20</strong> 24 26 27</p>
</li>
<li><p>选择最小的15和17合并，删除15和17，将32加入到森林，此时的权值为：18 20 24 26 27 <strong>32</strong></p>
</li>
<li><p>选择最小的18和20合并，删除18和20，将38加入到森林，此时的权值为：24 26 27 32 <strong>38</strong></p>
</li>
<li><p>选择最小的24和26合并，删除24和26，将20加入到森林，此时的权值为：27 32 38 <strong>50</strong></p>
</li>
<li><p>选择最小的27和32合并，删除27和32，将59加入到森林，此时的权值为：38 50 <strong>59</strong></p>
</li>
<li><p>选择最小的38和50合并，删除38和50，将88加入到森林，此时的权值为：59 <strong>88</strong></p>
</li>
<li><p>选择最小的59和88合并，删除59和88，将147加入到森林，此时的权值为：<strong>147</strong></p>
</li>
</ul>
<p>—End</p>
<p>根据上述权值构造的哈夫曼树如下：</p>
<p><img src="/picture/6.png" alt="Huffman Tree"></p>
<p><strong>背景为黄色的是新生成的树</strong></p>
<h3 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a><strong>逻辑回归</strong></h3><p>逻辑回归通常用来处理二分类问题，因变量通常只有两个可能的取值，自变量既可以是连续型变量，也可以是分类变量。</p>
<p>利用sigmoid函数，对于任意的样本$x=(x_1,x_2,\cdots,x_n)^T$，可将二分类问题的h函数(hypothesis)写成如下形式：</p>
<p>$$<br>h_\theta(x)=\sigma(\theta_0+\theta_1x_1+\cdots+\theta_nx_n)$$<br>,</p>
<p>其中$\theta =(\theta_0,\theta_1,\cdots,\theta_n)$为待定参数，为了简化起见，可以引入$x_0=1$将$x$扩展为$(x_0,x_1,\cdots,x_n)$,于是，$h_\theta$可简写为</p>
<p>$$<br>h_\theta(x)=\sigma(\theta^Tx)=\frac{1}{1+e^{-\theta^Tx}}<br>$$</p>
<p>sigmoid函数图像如下：</p>
<p><img src="/picture/7.png" alt="sigmoid"></p>
<p><strong>函数$h_\theta(x)$的值有特殊的含义，它表示结果取1的概率，因此对于输入$x$,分类结果为类别1和类别0的概率分别为：</strong></p>
<p>$$<br>P(y=1\vert x;\theta)=h_\theta(x)<br>$$</p>
<p>$$<br>P(y=0\vert x;\theta)=1-h_\theta(x)<br>$$</p>
<p>上式也可以写成如下综合形式：</p>
<p>$$<br>P(y\vert x;\theta)=(h_\theta(x))^y(1-h_\theta(x))^{1-y}<br>$$</p>
<p><strong>sigmoid函数具有很好的导数特征</strong></p>
<p>已知</p>
<p>$$<br>\sigma(x) = \frac{1}{1+e^{-x}}<br>$$</p>
<p>则</p>
<p>$$<br>\sigma(x)^{‘}=\frac{e^{-x}}{(1+e^{-x})^2}=\sigma(x)(1-\sigma(x))<br>$$</p>
<p>另外</p>
<p>$$<br>[log\sigma(x)]^{‘}=1-\sigma(x),[log(1-\sigma(x))^{‘}=- \sigma(x)<br>$$</p>
<h3 id="Hierarchical-Softmax-1"><a href="#Hierarchical-Softmax-1" class="headerlink" title="Hierarchical Softmax"></a><strong>Hierarchical Softmax</strong></h3><p>hierarchical softmax使用一颗二叉树的叶子结点来代表输出层对应词汇表中每个词的输出结果。每个结点都代表了它的孩子结点的相关概率。这种方式定义了一种给词分配概率的随机游走解决方案。</p>
<p>准确地说，从根结点出发，每一个词都能以一条确定的路径抵达。对所使用的符号作如下阐述：</p>
<ul>
<li><p>$w$：代表词汇表中的词，用叶子结点表示</p>
</li>
<li><p>$n(w,j)$：从根结点到达某个叶子结点的路径上的第$j$个结点，根结点为第一个结点</p>
</li>
<li><p>$L(w)$：路径的长度，也就是结点的个数</p>
</li>
</ul>
<p>因此，$n(w,1)=root,n(w,L(w))=w$</p>
<ul>
<li><p>$n$：非叶子结点</p>
</li>
<li><p>$ch(n)$：非叶子结点的孩子结点</p>
</li>
<li><p>$[[x]]$：if x is true,than 1,else than -1</p>
</li>
</ul>
<p>hierarchical softmax定义$P(w_o\vert w_i)$如下：</p>
<p>$$<br>P(w\vert w_i)=\prod_{j=1}^{L(w)-1}\sigma([[n(w,j+1)=ch(n(w,j))]]\cdot (v^{‘}<em>{n(w,j)})^T v</em>{w_i})<br>$$</p>
<p>其中</p>
<p>$$<br>\sigma(x)=1/(1+e^{-x})<br>$$</p>
<p>可以证明：</p>
<p>$$<br>\sum _{i=1}^Wp(w\vert w_i)=1<br>$$</p>
<p>那么，hierarchical softmax框架下的skip-gram结构是什么样的呢?</p>
<p><img src="/picture/8.png" alt="hierarchical softmax skip-gram"></p>
<p>如上图所示，与basic版本的skip-gram模型相比，hierarchical softmax版本的模型输出层不再是线性结构，而是树形结构。</p>
<p>上面已经说过，线性结构的skip-gram模型的参数规模十分庞大，最大能够达到$10^7$数量级，再加上动辄10亿级别的语料库，训练代价很高，效率就特别低了。</p>
<p>引入了hierarchical softmax以后，输出层的维度得到了大幅降低。正如作者所说，计算$logp(w_o\vert w_i)$和$\nabla logp(w_o\vert w_i)$的代价是与$L(w_o)$也就是哈夫曼树的深度成正比的。</p>
<p><strong>下面假装正经地推导参数的更新过程：</strong></p>
<p>假设我们的训练样本是【今天我上课迟到了，然后被老师批评了】，对应词汇表中的词汇为【今天 我 上课 迟到 了 然后 被 老师 批评】</p>
<p>假设在语料库中，上述词汇对应的频数如下表所示：</p>
<table>
<thead>
<tr>
<th align="center">词汇</th>
<th align="center">频率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">今天</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">我</td>
<td align="center">15</td>
</tr>
<tr>
<td align="center">上课</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">迟到</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">了</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">然后</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">被</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">老师</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">批评</td>
<td align="center">2</td>
</tr>
</tbody></table>
<p>将频率看做是哈夫曼树的权值，将大的权值放在左子树，小的权值放在右子树。</p>
<p>绘制出的带权值的哈夫曼树如下：</p>
<p><img src="%5Cpicture%5C9.png" alt="output"></p>
<p>说明如下：</p>
<ul>
<li><p>黄色的结点表示新生成的树</p>
</li>
<li><p>$\theta_i^w \in R^m$，非叶子结点对应的向量</p>
</li>
<li><p>$d_1^w,d_2^w,\cdots,d_{l(w)-1}^w \in {0,1}$：词$w$的哈夫曼编码，由$l(w)-1$位编码构成，$d_j^w$对应对应路径中第$j$个非叶子结点的编码(0 or 1).</p>
</li>
</ul>
<p>根据基于hierarchical softmax的skip-gram模型，投影层将输入的one-hot向量投影成$R^m$空间中的向量，即输出层接受的输入为投影层的输出，即$v_m$。</p>
<p>目标函数仍然是最大化对数似然概率，那么，当前的重点是条件概率函数的构造。</p>
<p>skip-gram模型将其定义为</p>
<p>$$P(context(w_i)\vert w_i)=\prod _{u\in context(w_i)}p(u\vert w_i)$$</p>
<p>而根据hierarchical softmax的思想，$p(u\vert w_i)$可以写出如下形式：</p>
<p>$$p(u\vert w_i)=\prod <em>{j=2}^{l(w)}p(d_j^u\vert v_m;\theta</em>{j-1}^u)$$</p>
<p>其中</p>
<p>$$p(d_j^u\vert v_m;\theta_{j-1}^u)=[\sigma(v_m^T\theta^u_{j-1})]^{1-d_j^u}\cdot[1-\sigma(v_m^T\theta^u_{j-1})]^{d_j^u}$$</p>
<p>那么，我们的目标函数可以写成如下形式：</p>
<p>$$L=\sum <em>{w\in C} log \prod _{u\in context(w)}\prod _{j=2}^{l(w)}[\sigma(v_m^T\theta^u</em>{j-1})]^{1-d_j^u}\cdot[1-\sigma(v_m^T\theta^u_{j-1})]^{d_j^u}$$<br>$$=\sum <em>{w\in C}\sum _{u \in context(w)}\sum _{j=2}^{l(w)}{(1-d_j^u)\cdot log[\sigma(v_m^T\theta^u</em>{j-1})]+d_j^u\cdot log[1-\sigma(v_m^T\theta^u_{j-1})]}$$</p>
<p>上面的函数就是skip-gram的目标函数，为了方便推导梯度，将三重求和符号下花括号的内容简记为$L(w,u,j)$，即</p>
<p>$$L(w,u,j)=(1-d_j^u)\cdot log[\sigma(v_m^T\theta^u_{j-1})]+d_j^u\cdot log[1-\sigma(v_m^T\theta^u_{j-1})]$$</p>
<p>首先考虑$L$关于$\theta_{j-1}^u$的梯度计算：</p>
<p>$$\frac{\partial L}{\partial \theta_{j-1}^u}=\frac{\partial L(w,u,j)}{\partial \theta_{j-1}^u}=\frac{\partial {(1-d_j^u)\cdot log[\sigma(v_m^T\theta^u_{j-1})]+d_j^u\cdot log[1-\sigma(v_m^T\theta^u_{j-1})]}}
{\partial \theta_{j-1}^u}=[1-d_j^u-\sigma(v_m^T\theta_{j-1}^u)]\cdot v_m$$</p>
<p>于是，$\theta_{j-1}^u$的更新公式可写为：</p>
<p>$$\theta_{j-1}^u\leftarrow \theta_{j-1}^u+\epsilon [1-d_j^u-\sigma(v_m^T\theta_{j-1}^u)]\cdot v_m$$</p>
<p>接下来考虑$L$对$v_m$的梯度。由于在$L$中，$v_m$与$\theta_{j-1}^u$具有对称性，因此可以根据上述所求，直接写出$v_m$的更新公式：</p>
<p>$$v_m\leftarrow v_m+\epsilon \sum _{u\in C}\sum _{j=2}^{l(w)}\frac{\partial L(w,u,j)}{\partial v_m}$$</p>
<p>其中，$\epsilon$是学习率。</p>
<h2 id="Negative-Sampling-and-Subsampling-of-Frequent-Words"><a href="#Negative-Sampling-and-Subsampling-of-Frequent-Words" class="headerlink" title="Negative Sampling and Subsampling of Frequent Words"></a>Negative Sampling and Subsampling of Frequent Words</h2><p>考虑到basic版本的skip-gram模型拥有两个异常巨大的权重矩阵，再加上一个10亿数量级的语料库，神经网络跑起来会非常吃力。</p>
<p>word2vec的作者是这样处理这个问题的，主要有以下三个创新点：</p>
<ol>
<li><p>将常用词对或者词组看成一个单独的词</p>
</li>
<li><p>subsampling(降采样)出现频率很高的词以减小训练样本的大小</p>
</li>
<li><p>使用一种被称为”Negative Sampling”的方法来改变优化目标，这种方法在训练时只优化与训练样本有关的很小一丢丢权重。</p>
</li>
</ol>
<p><strong>值的一提的是，应用Subsampling和NEG方法不仅可以减小计算压力，还能提高最终产生的词向量的质量。</strong></p>
<h3 id="Negative-Sampling"><a href="#Negative-Sampling" class="headerlink" title="Negative Sampling"></a>Negative Sampling</h3><p>回想一下那个basic版本的skip-gram，神经网络的真实值或者说标签是一个one-hot矩阵，也就是说，只有一个分量是1，而其他分量都是0(成千上万个0)。但是我们在更新神经网络权重的时候，对于所有的输出为0的权重都进行了更新，这样效率是比较差的。</p>
<p>negative sampling的思想就是，当我们在训练一个特定样本的时候，能不能只更新几个输出为0的权重，这样计算起来就比较轻松了。</p>
<p>我们把one-hot向量分量为负的位置所对应的词称为negative words，在训练一次样本时，我们只更新几个(假如说5个吧)negative words，同时也更新我们的pisitive words(即分量为1所对应的位置在词汇表中对应的词)。</p>
<p>作者在论文中说到，当样本量比较小的时候，选择5-20个negative words效果会比较好，当样本量比较大的时候，2-5个negative words就能得到很好的效果。</p>
<p>现在假设我们在basic model中需要更新的权重矩阵为$300\times 10000$矩阵，那么basic model每次迭代需要更新$3\times 10^6$个参数，而采用了negative sampling 方法以后，我们只需要更新5个negative words和1个positive words对应的权重，也就是$300\times (5+1)=1800$个权重，是原来的$1800/3\times 10^6=0.06%$.</p>
<p>想法是好的，我们要怎么选择这5个negative words呢？</p>
<p>我们知道，语料库中的每个词都有一定的频率，那么我们就利用频率这个信息，对negative words进行采样。</p>
<p>由此可见，高频词被选为negative words的概率就比较大，同理，低频词被选为negative words的概率就比较小。</p>
<p>作者的处理方法是，赋予每一个词被选为negative words的概率，具体计算公式如下：<br>$$<br>P(w_i)=\frac{f(w_i)^{0.75}}{\sum _{j=0}^nf(w_i)^{0.75}}<br>$$<br>,</p>
<p>至于为什么是0.75，这是作者及其团队经过不断试验得出的效果比较好的，没有特别的原因。</p>
<p>计算出了概率，我们又怎么选择相应的negative words呢？</p>
<p>作者在其代码中给出了答案。</p>
<p><strong>下面给出了具体的方法：</strong></p>
<ol>
<li><p>构造一个很长的数组,作者的数组长度达到了1000000</p>
</li>
<li><p>将词汇表中的每个词对应的index(索引)向数组中填充多次，填充的次数是这样计算的：</p>
</li>
</ol>
<p>根据一元模型可以从语料库生成样本（也就是把语料库中的文本以词的形式展示）</p>
<p>填充次数times的计算公式为：</p>
<p>$$<br>times = P(w_i)\times 100000<br>$$</p>
<ol start="3">
<li>欲选出你的negative words，只需要在0-100M之间随机生成一个整数，以这个整数为索引，在数组中查找元素，该元素也是一个索引，根据这个元素从词汇表中查找negative words。</li>
</ol>
<p><strong>不难理解，$P(w_i)$大的被选中的概率就大。</strong></p>
<h3 id="Subsampling-of-Frequent-Words"><a href="#Subsampling-of-Frequent-Words" class="headerlink" title="Subsampling of Frequent Words"></a>Subsampling of Frequent Words</h3><p>让我们再看一遍词对的生成过程。</p>
<p><img src="/picture/3.png" alt="word-pairs"></p>
<p>如上图所示，我们设定window size = 2 来生成样本。对于包含”the”的词对来说，有以下两个问题：</p>
<ol>
<li><p>当我们在寻找词对的时候，(“fox”,”the”)所能提供的信息并不比”fox”多。然而，”the”几乎在上面的所有词对中都有出现。</p>
</li>
<li><p>形如(“the”,…)这样的词对已经远远超过了我们的需求。</p>
</li>
</ol>
<p>word2vec 应用了一种称之为subsampling的方法来解决这个问题。</p>
<p>对于我们遇到每一个语料库中的词，都有一定的概率将它从语料库中删除，删除的概率与该词出现的频率有关。</p>
<p>如果我们将window size 设置为10，我们是这样删除”the”相关样本的：</p>
<ol>
<li><p>我们在训练其他词的时候，”the”不会出现在他们的窗口</p>
</li>
<li><p>当输入词是”the”的时候，将样本数减少10个(不减少的情况下是20)</p>
</li>
</ol>
<p>那么，我们怎么决定是否删除一个词呢？</p>
<p>假设$w_i$是待定删除的词，$z(w_i)$是$w_i$在语料库中出现的频率,$P(w_i)$是保留该词的概率:</p>
<p>$$<br>P(w_i)=(\sqrt{\frac{z(w_i)}{0.001}}+1)\cdot \frac{0.001}{z(w_i)}<br>$$</p>
<p><strong>0.001也是一个经验参数，如果比0.001还要小，那么保留词的概率就会更小。</strong></p>
<p>下面是$P(w_i)$函数的图像：</p>
<p><img src="/picture/10.png" alt="p(wi)"></p>
<p>从图像可以看出：</p>
<ul>
<li><p>当频率等于0.0026的时候，被保留的概率为1，也就是说，当频率大于0.0026的时候，就有可能被删除。</p>
</li>
<li><p>当频率为0.0074的时候，有一半的概率会被保留</p>
</li>
<li><p>当频率为0.1的时候，被保留的概率就骤减到0.1</p>
</li>
</ul>
<h3 id="Learning-Phrase"><a href="#Learning-Phrase" class="headerlink" title="Learning Phrase"></a>Learning Phrase</h3><p>learning phrase 方法使得样本更加接近真实世界。考虑以下句子：</p>
<pre><code>New York is a beautiful and modern city where I want to have a travel.</code></pre><p>我们设置窗口大小为4，对beautiful进行采样，获得如下样本：</p>
<pre><code>(beautiful,New) (beautiful,York) (beautiful,is) (beautiful,a) (beautiful,New) (beautiful,and) (beautiful,modern) (beautiful,city) </code></pre><p>采用一元的方法，会将常用的词组分开，从而降低词向量的质量。</p>
<p>我们可以采取一个简单的数据驱动的方法，来对两个词是否能组成词组进行打分：</p>
<p>$$<br>score(w_i,w_j) = \frac{count(w_iw_j)-\delta}{count(w_i)\times count(w_j)}<br>$$</p>
<p>$\delta$作为一个折扣系数的作用，用来防止那些不怎么经常一起出现的词语形成词组。当score超过了我们设置的阈值时，将两个词视为词组。</p>
<p>上述打分程序可以多进行几次，以获得三元组或者更多词的词组。</p>
<hr>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1]McCormick, C. (2016, April 19). Word2Vec Tutorial - The Skip-Gram Model. Retrieved from <a href="http://www.mccormickml.com" target="_blank" rel="noopener">http://www.mccormickml.com</a></p>
<p>[2]Pennington J, Socher R, Manning C. Glove: Global Vectors for Word Representation[C]// Conference on Empirical Methods in Natural Language Processing. 2014:1532-1543.</p>
<p>[3]Mikolov T, Le Q V, Sutskever I. Exploiting Similarities among Languages for Machine Translation[J]. Computer Science, 2013.</p>
<p>[4]Mikolov T, Chen K, Corrado G, et al. Efficient Estimation of Word Representations in Vector Space[J]. Computer Science, 2013.</p>
<p>[5]Bengio, Y &amp; Ducharme, Réjean &amp; Vincent, Pascal. (2000). A Neural Probabilistic Language Model. Journal of Machine Learning Research. 3. 932-938. 10.1162/153244303322533223. </p>
<p>[6]NSS,(JUNE 4, 2017).An Intuitive Understanding of Word Embeddings: From Count Vectors to Word2Vec.Retrieved from <a href="https://www.analyticsvidhya.com/blog/2017/06/word-embeddings-count-word2veec/" target="_blank" rel="noopener">https://www.analyticsvidhya.com/blog/2017/06/word-embeddings-count-word2veec/</a></p>
<p>[7]peghoty,2014年07月.word2vec 中的数学原理详解.<a href="http://blog.csdn.net/itplus/article/details/37969519" target="_blank" rel="noopener">http://blog.csdn.net/itplus/article/details/37969519</a></p>
<p>[8]吴军．数学之美[M]．北京：人民邮电出版社，2014.</p>
<p>==========================The End=============================</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">上一页</a>
        </div>
        <div class="pagination-next is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/4/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link is-current" href="/page/3/">3</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="https://www.gravatar.com/avatar/d2bf9993682e898ece4bb36e7d4b40b3?s=128" alt="Feng Yangyang">
                    
                    
                    <p class="is-size-4 is-block">
                        Feng Yangyang
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Data Analyst
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>PuDong,ShangHai</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        25
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        2
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        22
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="/" target="_blank">
                关注我</a>
        </div>
        
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">甘医生</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/NLP/">
            <span class="level-start">
                <span class="level-item">NLP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/大数据/">
            <span class="level-start">
                <span class="level-item">大数据</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/ETL/" style="font-size: 10px;">ETL</a> <a href="/tags/Lubridate/" style="font-size: 10px;">Lubridate</a> <a href="/tags/MapReduce/" style="font-size: 10px;">MapReduce</a> <a href="/tags/R/" style="font-size: 10px;">R</a> <a href="/tags/clustering/" style="font-size: 10px;">clustering</a> <a href="/tags/kmeans/" style="font-size: 10px;">kmeans</a> <a href="/tags/优化算法/" style="font-size: 10px;">优化算法</a> <a href="/tags/岭回归/" style="font-size: 10px;">岭回归</a> <a href="/tags/感知机/" style="font-size: 10px;">感知机</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/数据仓库/" style="font-size: 10px;">数据仓库</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/机器学习/" style="font-size: 20px;">机器学习</a> <a href="/tags/梯度下降/" style="font-size: 10px;">梯度下降</a> <a href="/tags/深度学习/" style="font-size: 10px;">深度学习</a> <a href="/tags/爬虫/" style="font-size: 16.67px;">爬虫</a> <a href="/tags/矩阵分解/" style="font-size: 13.33px;">矩阵分解</a> <a href="/tags/神经网络/" style="font-size: 10px;">神经网络</a> <a href="/tags/线性回归/" style="font-size: 10px;">线性回归</a> <a href="/tags/自然语言处理/" style="font-size: 10px;">自然语言处理</a> <a href="/tags/逐步回归/" style="font-size: 10px;">逐步回归</a> <a href="/tags/降维/" style="font-size: 10px;">降维</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2018/07/02/R语言简明教程/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="R语言简明教程">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-07-02T03:43:55.696Z">2018-07-02</time></div>
                    <a href="/2018/07/02/R语言简明教程/" class="has-link-black-ter is-size-6">R语言简明教程</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/09/排序算法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="排序算法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-08T16:00:00.000Z">2018-05-09</time></div>
                    <a href="/2018/05/09/排序算法/" class="has-link-black-ter is-size-6">排序算法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/05/梯度下降/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="线性回归与梯度下降算法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-04T16:00:00.000Z">2018-05-05</time></div>
                    <a href="/2018/05/05/梯度下降/" class="has-link-black-ter is-size-6">线性回归与梯度下降算法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/04/牛顿法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="平方根与牛顿法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-04T02:50:15.447Z">2018-05-04</time></div>
                    <a href="/2018/05/04/牛顿法/" class="has-link-black-ter is-size-6">平方根与牛顿法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/03/逻辑回归/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="逻辑回归">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-02T16:00:00.000Z">2018-05-03</time></div>
                    <a href="/2018/05/03/逻辑回归/" class="has-link-black-ter is-size-6">逻辑回归</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ETL/">
                        <span class="tag">ETL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Lubridate/">
                        <span class="tag">Lubridate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MapReduce/">
                        <span class="tag">MapReduce</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/R/">
                        <span class="tag">R</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/clustering/">
                        <span class="tag">clustering</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kmeans/">
                        <span class="tag">kmeans</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/优化算法/">
                        <span class="tag">优化算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/岭回归/">
                        <span class="tag">岭回归</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/感知机/">
                        <span class="tag">感知机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/排序/">
                        <span class="tag">排序</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据仓库/">
                        <span class="tag">数据仓库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/梯度下降/">
                        <span class="tag">梯度下降</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/深度学习/">
                        <span class="tag">深度学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/爬虫/">
                        <span class="tag">爬虫</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/矩阵分解/">
                        <span class="tag">矩阵分解</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/神经网络/">
                        <span class="tag">神经网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线性回归/">
                        <span class="tag">线性回归</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/自然语言处理/">
                        <span class="tag">自然语言处理</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/逐步回归/">
                        <span class="tag">逐步回归</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/降维/">
                        <span class="tag">降维</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2018/07/02/R语言简明教程/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="R语言简明教程">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-07-02T03:43:55.696Z">2018-07-02</time></div>
                    <a href="/2018/07/02/R语言简明教程/" class="has-link-black-ter is-size-6">R语言简明教程</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/09/排序算法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="排序算法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-08T16:00:00.000Z">2018-05-09</time></div>
                    <a href="/2018/05/09/排序算法/" class="has-link-black-ter is-size-6">排序算法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/05/梯度下降/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="线性回归与梯度下降算法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-04T16:00:00.000Z">2018-05-05</time></div>
                    <a href="/2018/05/05/梯度下降/" class="has-link-black-ter is-size-6">线性回归与梯度下降算法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/04/牛顿法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="平方根与牛顿法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-04T02:50:15.447Z">2018-05-04</time></div>
                    <a href="/2018/05/04/牛顿法/" class="has-link-black-ter is-size-6">平方根与牛顿法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/05/03/逻辑回归/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="逻辑回归">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-05-02T16:00:00.000Z">2018-05-03</time></div>
                    <a href="/2018/05/03/逻辑回归/" class="has-link-black-ter is-size-6">逻辑回归</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ETL/">
                        <span class="tag">ETL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Lubridate/">
                        <span class="tag">Lubridate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MapReduce/">
                        <span class="tag">MapReduce</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/R/">
                        <span class="tag">R</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/clustering/">
                        <span class="tag">clustering</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kmeans/">
                        <span class="tag">kmeans</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/优化算法/">
                        <span class="tag">优化算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/岭回归/">
                        <span class="tag">岭回归</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/感知机/">
                        <span class="tag">感知机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/排序/">
                        <span class="tag">排序</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据仓库/">
                        <span class="tag">数据仓库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/梯度下降/">
                        <span class="tag">梯度下降</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/深度学习/">
                        <span class="tag">深度学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/爬虫/">
                        <span class="tag">爬虫</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/矩阵分解/">
                        <span class="tag">矩阵分解</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/神经网络/">
                        <span class="tag">神经网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线性回归/">
                        <span class="tag">线性回归</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/自然语言处理/">
                        <span class="tag">自然语言处理</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/逐步回归/">
                        <span class="tag">逐步回归</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/降维/">
                        <span class="tag">降维</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Young&#39;s Blog" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 冯洋洋&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>